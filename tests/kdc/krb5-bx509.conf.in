[libdefaults]
	default_realm = TEST.H5L.SE
	no-addresses = TRUE
	allow_weak_crypto = TRUE
        enable-kx509 = true

[appdefaults]
	pkinit_anchors = FILE:@objdir@/ca.crt
	pkinit_pool = FILE:@objdir@/ca.crt

[realms]
	TEST.H5L.SE = {
		kdc = localhost:@port@
		pkinit_win2k = @w2k@
	}

[kdc]
        strict-nametypes = true
	enable-pkinit = true
        pkinit_identity = PEM-FILE:@objdir@/user-issuer.pem
	pkinit_anchors = PEM-FILE:@objdir@/pkinit-anchor.pem
	pkinit_mappings_file = @srcdir@/pki-mapping

        # Locate kdc plugins for testing
        plugin_dir =  @objdir@/../token/.libs
        plugin_dir =  @objdir@/../csr_authorizer/.libs

        # Configure kdc plugins for testing
        stub_token_type = Stub
        stub_token_directory = @srcdir@/../token/stub_dir
        simple_csr_authorizer_directory = @srcdir@/../csr_authorizer/simple_dir

        enable-kx509 = true
        require_initial_kca_tickets = false
        kx509_proxy_client_service = bx509_service@TEST.H5L.SE

	database = {
		dbname = @objdir@/current-db
		realm = TEST.H5L.SE
		mkey_file = @objdir@/mkey.file
                log_file = @objdir@/log.current-db.log
	}

        realm = {
                TEST.H5L.SE = {
                        negotiate_token_validator = {
                                keytab = HDBGET:@objdir@/current-db
                        }
                        kx509 = {
                                user = {
                                        include_pkinit_san = true
                                        subject_name = CN=${principal-name-without-realm},DC=TEST,DC=H5L,DC=SE
                                        ekus = 1.3.6.1.5.5.7.3.2
                                        ca = PEM-FILE:@objdir@/user-issuer.pem
                                }
                                hostbased_service = {
                                        HTTP = {
                                                include_dnsname_san = true
                                                ekus = 1.3.6.1.5.5.7.3.1
                                                ca = PEM-FILE:@objdir@/server-issuer.pem
                                        }
                                }
                                client = {
                                        ekus = 1.3.6.1.5.5.7.3.2
                                        ca = PEM-FILE:@objdir@/user-issuer.pem
                                }
                                server = {
                                        ekus = 1.3.6.1.5.5.7.3.1
                                        ca = PEM-FILE:@objdir@/server-issuer.pem
                                }
                                mixed = {
                                        ekus = 1.3.6.1.5.5.7.3.1
                                        ekus = 1.3.6.1.5.5.7.3.2
                                        ca = PEM-FILE:@objdir@/user-issuer.pem
                                }
                        }
                }
        }

[hdb]
	db-dir = @objdir@

[logging]
	kdc = 0-/FILE:@objdir@/messages.log
	default = 0-/FILE:@objdir@/messages.log

[kadmin]
	save-password = true
